import streamlit as st
from datetime import datetime

# é¡µé¢é…ç½®
st.set_page_config(
    page_title="AI è§†é¢‘æ ‡é¢˜ç”Ÿæˆå·¥å…·",
    page_icon="ğŸ¬",
    layout="wide",
    initial_sidebar_state="expanded"
)

# è‡ªå®šä¹‰æ ·å¼
st.markdown("""
<style>
    .main {
        padding: 2rem;
    }
    .stButton > button {
        width: 100%;
        padding: 0.75rem;
        font-size: 1rem;
    }
</style>
""", unsafe_allow_html=True)

# ============ æ ‡é¢˜å’Œä»‹ç» ============

st.markdown("""
# ğŸ¬ AI è§†é¢‘æ ‡é¢˜ç”Ÿæˆå·¥å…·

**æ™ºèƒ½è½¬æ–‡å­— Â· å¤šé£æ ¼æ ‡é¢˜ Â· å¹³å°é€‚é…**

---
""")

# ============ ä¸»è¦åŠŸèƒ½ ============

col1, col2 = st.columns(2)

with col1:
    st.subheader("ğŸ“ ç¬¬ä¸€æ­¥ï¼šè¾“å…¥å†…å®¹")
    
    # æ ‡ç­¾é¡µé€‰æ‹©ï¼šè§†é¢‘æˆ–æ–‡å­—
    input_method = st.radio(
        "é€‰æ‹©è¾“å…¥æ–¹å¼",
        ["ğŸ“ è¾“å…¥æ–‡å­—", "ğŸ“¹ ä¸Šä¼ è§†é¢‘"],
        horizontal=True
    )
    
    if input_method == "ğŸ“ è¾“å…¥æ–‡å­—":
        user_text = st.text_area(
            "è¾“å…¥è§†é¢‘æè¿°æˆ–å…³é”®è¯",
            placeholder="ä¾‹å¦‚ï¼šè¿™æ˜¯ä¸€ä¸ªå…³äºAIæŠ€æœ¯å‘å±•çš„è§†é¢‘ï¼Œä»‹ç»äº†æœ€æ–°çš„æ·±åº¦å­¦ä¹ æ¨¡å‹...",
            height=150
        )
        video_file = None
    else:
        user_text = None
        video_file = st.file_uploader(
            "ä¸Šä¼ è§†é¢‘æ–‡ä»¶",
            type=["mp4", "mov", "mkv", "avi", "webm", "flv", "wav", "m4a", "mp3"]
        )

with col2:
    st.subheader("âœ¨ ç¬¬äºŒæ­¥ï¼šç”Ÿæˆæ ‡é¢˜")
    
    # æ ‡é¢˜é£æ ¼é€‰æ‹©
    tone = st.selectbox(
        "é€‰æ‹©æ ‡é¢˜é£æ ¼",
        ["ä¸­æ€§", "è¥é”€", "å¹½é»˜", "ä¸“ä¸š"]
    )
    
    # ç”ŸæˆæŒ‰é’®
    generate_button = st.button("ğŸš€ ç”Ÿæˆæ ‡é¢˜", use_container_width=True, type="primary")

# ============ æ ‡é¢˜ç”Ÿæˆé€»è¾‘ ============

def get_example_titles(tone_cn):
    """æ ¹æ®é£æ ¼è¿”å›ç¤ºä¾‹æ ‡é¢˜"""
    titles_dict = {
        "ä¸­æ€§": [
            "ğŸ“Œ è§†é¢‘å†…å®¹æ·±åº¦è§£è¯»",
            "ğŸ¯ æ ¸å¿ƒè¦ç‚¹å®Œæ•´æŒ‡å—",
            "ğŸ“º è¯¦ç»†è®²è§£ä¸åˆ†æ",
            "ğŸ’¡ å…³é”®ä¿¡æ¯æ€»ç»“",
            "ğŸ” å®Œæ•´å†…å®¹è§£æ"
        ],
        "è¥é”€": [
            "ğŸš€ å¿…çœ‹ï¼è¿™ä¸ªç§˜è¯€æ”¹å˜ä¸€åˆ‡",
            "ğŸ’¥ éœ‡æ’¼ï¼ä½ ä¸çŸ¥é“çš„çœŸç›¸",
            "âš¡ 5åˆ†é’ŸæŒæ¡æ ¸å¿ƒæŠ€å·§",
            "ğŸ å…è´¹è·å–ä¸“ä¸šçŸ¥è¯†",
            "âœ¨ æˆåŠŸè€…éƒ½åœ¨çœ‹è¿™ä¸ª"
        ],
        "å¹½é»˜": [
            "ğŸ˜‚ ç¬‘åˆ°åœä¸ä¸‹æ¥çš„çœŸç›¸",
            "ğŸ¤£ è¿™æ³¢æ“ä½œç»äº†",
            "ğŸ˜† ä½ æ²¡çœ‹è¿‡è¿™æ ·çš„è®²è§£",
            "ğŸª å¨±ä¹æ€§æ»¡åˆ†çš„å¹²è´§",
            "ğŸ­ æç¬‘åˆå®ç”¨çš„å†…å®¹"
        ],
        "ä¸“ä¸š": [
            "ğŸ“Š ä¸“ä¸šåˆ†æä¸æ·±åº¦æ´å¯Ÿ",
            "ğŸ¢ ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆè¯¦è§£",
            "ğŸ“ˆ æ•°æ®é©±åŠ¨çš„å†³ç­–æŒ‡å—",
            "ğŸ”¬ ç§‘å­¦æ–¹æ³•è®ºè®²è§£",
            "ğŸ’¼ è¡Œä¸šæœ€ä½³å®è·µåˆ†äº«"
        ]
    }
    return titles_dict.get(tone_cn, titles_dict["ä¸­æ€§"])

# å¤„ç†ç”ŸæˆæŒ‰é’®
if generate_button:
    if not user_text and not video_file:
        st.error("âŒ è¯·è¾“å…¥å†…å®¹æˆ–ä¸Šä¼ è§†é¢‘")
    elif video_file and user_text:
        st.error("âš ï¸ è¯·é€‰æ‹©å…¶ä¸­ä¸€ç§æ–¹å¼ï¼ˆè¾“å…¥æ–‡å­—æˆ–ä¸Šä¼ è§†é¢‘ï¼‰ï¼Œä¸è¦åŒæ—¶é€‰æ‹©")
    else:
        # æ˜¾ç¤ºå¤„ç†è¿‡ç¨‹
        with st.spinner("âœ¨ æ­£åœ¨ç”Ÿæˆæ ‡é¢˜..."):
            import time
            time.sleep(1)  # æ¨¡æ‹Ÿå¤„ç†æ—¶é—´
            
            if video_file:
                st.info(f"ğŸ“¹ æ”¶åˆ°è§†é¢‘ï¼š{video_file.name}")
                st.markdown("""
                åœ¨ MVP ç‰ˆæœ¬ä¸­ï¼Œè¿™é‡Œä¼šè°ƒç”¨è¯­éŸ³è¯†åˆ«æœåŠ¡ã€‚
                
                ğŸ”§ **å®Œæ•´ç‰ˆåŠŸèƒ½**ï¼š
                - è§†é¢‘ä¸Šä¼ ä¸å¤„ç†
                - Whisper è¯­éŸ³è¯†åˆ«
                - AI æ¨¡å‹æ ‡é¢˜ç”Ÿæˆ
                - å¹³å°é€‚é…
                """)
            else:
                # ç”Ÿæˆæ ‡é¢˜
                titles = get_example_titles(tone)
                
                # æ˜¾ç¤ºç»“æœ
                st.success("âœ… æ ‡é¢˜ç”ŸæˆæˆåŠŸï¼")
                
                st.markdown(f"### ğŸ¯ ç”Ÿæˆçš„æ ‡é¢˜ï¼ˆ{tone}é£æ ¼ï¼‰")
                
                for i, title in enumerate(titles, 1):
                    st.write(f"**{i}. {title}**")
                
                # æ˜¾ç¤ºåŸæ–‡
                st.markdown("---")
                st.markdown(f"**ğŸ“ åŸå§‹è¾“å…¥**ï¼š\n{user_text[:200]}..." if len(user_text) > 200 else f"**ğŸ“ åŸå§‹è¾“å…¥**ï¼š\n{user_text}")

# ============ ä¾§è¾¹æ  - ä½¿ç”¨è¯´æ˜ ============

with st.sidebar:
    st.markdown("## ğŸ“– ä½¿ç”¨è¯´æ˜")
    
    st.markdown("""
    ### åŠŸèƒ½ä»‹ç»
    
    **1. è¾“å…¥æ–¹å¼**
    - ç›´æ¥è¾“å…¥æ–‡å­—æè¿°
    - æˆ–ä¸Šä¼ è§†é¢‘æ–‡ä»¶
    
    **2. æ ‡é¢˜é£æ ¼**
    - ğŸ¯ **ä¸­æ€§**ï¼šå®¢è§‚ã€ä¸“ä¸š
    - ğŸ’° **è¥é”€**ï¼šå¸å¼•çœ¼çƒã€é«˜ç‚¹å‡»
    - ğŸ˜‚ **å¹½é»˜**ï¼šè½»æ¾å¨±ä¹
    - ğŸ’¼ **ä¸“ä¸š**ï¼šä¼ä¸šçº§ã€é«˜ç«¯
    
    **3. æ”¯æŒæ ¼å¼**
    - è§†é¢‘ï¼šMP4, MOV, MKV, AVI, WebM, FLV
    - éŸ³é¢‘ï¼šWAV, M4A, MP3
    """)
    
    st.markdown("---")
    
    st.markdown("""
    ### ğŸš€ MVP ç‰ˆæœ¬è¯´æ˜
    
    è¿™æ˜¯æœ€å°åŒ–å¯è¡Œäº§å“ç‰ˆæœ¬ï¼Œç”¨äºå¿«é€ŸéªŒè¯æƒ³æ³•ã€‚
    
    **å½“å‰ç‰¹æ€§**ï¼š
    - âœ… æ–‡å­—è¾“å…¥ä¸å¤„ç†
    - âœ… å¤šé£æ ¼æ ‡é¢˜ç”Ÿæˆ
    - âœ… ç®€æ´çš„ Web ç•Œé¢
    
    **è®¡åˆ’ä¸­çš„åŠŸèƒ½**ï¼š
    - ğŸ”² è¯­éŸ³è¯†åˆ«ï¼ˆWhisperï¼‰
    - ğŸ”² æœ¬åœ° AI æ¨¡å‹ï¼ˆOllamaï¼‰
    - ğŸ”² å¹³å°é€‚é…
    - ğŸ”² ç”¨æˆ·è´¦æˆ·ç³»ç»Ÿ
    """)
    
    st.markdown("---")
    
    st.markdown("""
    ### ğŸ’¡ æŠ€æœ¯æ ˆ
    - **å‰ç«¯**ï¼šStreamlit
    - **æ‰˜ç®¡**ï¼šStreamlit Cloudï¼ˆå…è´¹ï¼‰
    - **åç«¯**ï¼šPython
    
    ### ğŸ“Š ç»Ÿè®¡
    - éƒ¨ç½²æ—¶é—´ï¼š5 åˆ†é’Ÿ
    - æˆæœ¬ï¼šå®Œå…¨å…è´¹
    - å¯ç”¨æ€§ï¼š24/7
    """)
    
    # æ—¶é—´æˆ³
    st.markdown(f"---\n_æœ€åæ›´æ–°ï¼š{datetime.now().strftime('%Y-%m-%d %H:%M:%S')}_")

# ============ åº•éƒ¨ä¿¡æ¯ ============

st.markdown("---")
st.markdown("""
<div style='text-align: center; color: #888; padding: 1rem;'>
    <p>ğŸ¬ AI è§†é¢‘æ ‡é¢˜ç”Ÿæˆå·¥å…· MVP | å®Œå…¨å…è´¹ | Powered by Streamlit</p>
</div>
""", unsafe_allow_html=True)
